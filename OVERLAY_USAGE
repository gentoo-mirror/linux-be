# To install a minimal git:
# echo "dev-vcs/git -gpg -iconv -nls -pcre-jit -pcre -perl -python -webdav" >> /etc/portage/package.use/git
# emerge -avt dev-vcs/git

git clone https://gitlab.com/linux-be/overlay.git
cd overlay

installed_overlay=/var/git/linux-be

rsync -av --del . $installed_overlay
chown -R portage:portage $installed_overlay

mkdir -p /etc/portage/repos.conf
cat >> /etc/portage/repos.conf/linux-be << EOF
[linux-be]
location = $installed_overlay
auto-sync = no
EOF

mkdir -p /etc/portage/package.use
ln -s "$installed_overlay"/Documentation/package.use/linux-be.use /etc/portage/package.use/

mkdir -p /etc/portage/package.accept_keywords
ln -s "$installed_overlay"/Documentation/package.accept_keywords/linux-be.keywords /etc/portage/package.accept_keywords/

# There are multiple branches of zfs with beadm:
# - one based on zfs's master branch,
# - one based on zfs's zfs-0.7-release branch.
# libbe and beadm have the same functionality in either of them.

# To use the version based on zfs master:
ln -s "$installed_overlay"/Documentation/package.accept_keywords/linux-be-zfs-master.keywords /etc/portage/package.accept_keywords/

# To use the version based on zfs-0.7-release:
ln -s "$installed_overlay"/Documentation/package.accept_keywords/linux-be-zfs-0.7.keywords /etc/portage/package.accept_keywords/

emerge -avt {zfs{,-kmod},grub,genkernel,bemerge}::linux-be spl
