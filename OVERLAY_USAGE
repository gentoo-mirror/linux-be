# To install a minimal git:
# echo "dev-vcs/git -gpg -iconv -nls -pcre-jit -pcre -perl -python -webdav" >> /etc/portage/package.use/git
# emerge -avt dev-vcs/git

git clone https://gitlab.com/linux-be/overlay.git
cd overlay

installed_overlay=/var/git/linux-be

rsync -av --del . $installed_overlay
chown -R portage:portage $installed_overlay

mkdir -p /etc/portage/repos.conf
cat >> /etc/portage/repos.conf/linux-be << EOF
[linux-be]
location = $installed_overlay
auto-sync = no
EOF

mkdir -p /etc/portage/package.accept_keywords
cat >> /etc/portage/package.accept_keywords/main <<EOF

# For linux-be
=sys-apps/bemerge-9999 ~amd64
=sys-apps/genkernel-3.5.2.4 ~amd64
=sys-boot/grub-9999 **
EOF

# There are multiple branches of zfs with beadm:
# - one based on zfs's master branch,
# - one based on zfs's zfs-0.7-release branch.
# libbe and beadm have the same functionality in either of them.

# To use the version based on zfs master:
cat >> /etc/portage/package.accept_keywords/main <<EOF
=sys-fs/zfs-9999 **
=sys-fs/zfs-kmod-9999 **
=sys-kernel/spl-9999 **
EOF

# To use the version based on zfs-0.7-release:
cat >> /etc/portage/package.accept_keywords/main <<EOF
=sys-fs/zfs-0.7.9999 **
=sys-fs/zfs-kmod-0.7.9999 **
=sys-kernel/spl-0.7.9999 **
EOF

emerge -avt {zfs{,-kmod},grub,genkernel,bemerge}::linux-be spl
